{% extends "base.html" %}

{% block content %}
<div class="max-w-2xl mx-auto bg-white rounded-lg shadow-md p-8">
    <h2 class="text-2xl font-bold mb-6 text-center">Find Nearby Houses</h2>
    
    <div class="mb-8">
        <label class="block text-gray-700 mb-2">Enter your address with coordinates</label>
        <div class="text-sm text-gray-600 mb-4">
            Format: Street address, City, Country<br>
            Example: 123 Main St, New York, USA
        </div>
        <input 
            id="address-input" 
            type="text" 
            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter address (e.g., 123 Main St, New York, USA)"
        >
        <div class="mt-4">
            <label class="block text-gray-700 mb-2">
                Search radius: <span id="radius-value">100</span> meters
            </label>
            <input 
                type="range" 
                id="radius-slider" 
                min="50" 
                max="200" 
                value="100"
                step="10"
                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
            >
            <div class="flex justify-between text-xs text-gray-600">
                <span>50m</span>
                <span>200m</span>
            </div>
        </div>
        <button 
            id="search-button" 
            class="mt-4 w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600"
        >
            Search Nearby Houses
        </button>
    </div>

    <div id="results" class="space-y-4">
        <!-- Results will be populated here -->
    </div>
</div>

<script>
    // Update radius value display when slider moves
    const radiusSlider = document.getElementById('radius-slider');
    const radiusValue = document.getElementById('radius-value');
    
    radiusSlider.addEventListener('input', (e) => {
        radiusValue.textContent = e.target.value;
    });

    document.getElementById('search-button').addEventListener('click', async () => {
        const input = document.getElementById('address-input').value;
        const radius = document.getElementById('radius-slider').value;
        
        if (!input) {
            alert('Please enter an address');
            return;
        }

        try {
            const response = await fetch(`/api/nearby-houses?address=${encodeURIComponent(input)}&radius=${radius}`);
            const houses = await response.json();
            
            if (houses.error) {
                alert(houses.error);
                return;
            }

            displayHouses(houses);
        } catch (error) {
            console.error('Error:', error);
            alert('Error fetching nearby houses');
        }
    });

    function displayHouses(houses) {
        const resultsDiv = document.getElementById('results');
        if (houses.length === 0) {
            resultsDiv.innerHTML = `
                <div class="text-center text-gray-600">
                    No houses found within 100 meters.
                </div>
            `;
        } else {
            resultsDiv.innerHTML = `
                <h3 class="font-semibold text-lg mb-2">Houses within 100 meters:</h3>
                <div class="space-y-2">
                    ${houses.map(house => `
                        <div class="p-4 border rounded-lg">
                            <p class="text-gray-800 font-medium">${house.address}</p>
                            <div class="text-sm text-gray-600 mt-1">
                                <p>Type: ${house.type}</p>
                                <p>Distance: ${house.distance}</p>
                                <p class="text-xs">Coordinates: (${house.lat}, ${house.lng})</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
    }
</script>
{% endblock %} 